# 本地数据备份功能文档

## 1. 功能概述

本地数据备份功能允许用户手动或自动创建游戏数据的备份，并在需要时恢复数据。该功能确保用户的游戏进度、设置和个人数据不会丢失，提供了可靠的数据安全保障。

## 2. 数据范围

本地备份功能覆盖以下数据范围：

| 数据类别 | 备份范围 | 存储位置 |
|---------|---------|---------|
| 用户设置 | 游戏配置、主题偏好、自动备份设置 | localStorage |
| 项目管理 | 所有项目数据、子任务、进度信息 | localStorage |
| 习惯追踪 | 习惯列表、完成记录、统计数据 | localStorage |
| 角色数据 | 角色属性、等级、成就 | localStorage |
| 成就系统 | 已解锁成就、进度统计 | localStorage |

## 3. 支持的数据项

### 3.1 核心数据结构

备份文件包含以下核心数据项：

```json
{
  "settings": {},        // 游戏设置
  "projects": [],        // 项目列表
  "habits": [],          // 习惯列表
  "characters": [],      // 角色数据
  "achievements": [],    // 成就数据
  "timestamp": ""        // 备份时间戳
}
```

### 3.2 数据项详细说明

#### 3.2.1 设置数据 (settings)

| 字段名 | 类型 | 说明 |
|-------|------|------|
| theme | string | 主题设置 (light/dark/neomorphic-light/neomorphic-dark) |
| soundEnabled | boolean | 声音开关 |
| notificationsEnabled | boolean | 通知开关 |
| autoBackupEnabled | boolean | 自动备份开关 |
| autoBackupInterval | number | 自动备份间隔 (分钟) |
| autoBackupTime | string | 自动备份时间 |

#### 3.2.2 项目数据 (projects)

| 字段名 | 类型 | 说明 |
|-------|------|------|
| id | string | 项目唯一标识 |
| name | string | 项目名称 |
| description | string | 项目描述 |
| createdAt | string | 创建时间 |
| dueDate | string | 截止日期 |
| completed | boolean | 完成状态 |
| progress | number | 进度百分比 |
| subTasks | SubTask[] | 子任务列表 |
| logs | ProjectLog[] | 项目日志 |

#### 3.2.3 习惯数据 (habits)

| 字段名 | 类型 | 说明 |
|-------|------|------|
| id | string | 习惯唯一标识 |
| name | string | 习惯名称 |
| description | string | 习惯描述 |
| icon | string | 习惯图标 |
| color | string | 习惯颜色 |
| frequency | string | 频率设置 |
| target | number | 目标值 |
| completedDates | string[] | 完成日期列表 |
| stats | HabitStats | 习惯统计数据 |

#### 3.2.4 角色数据 (characters)

| 字段名 | 类型 | 说明 |
|-------|------|------|
| id | string | 角色唯一标识 |
| name | string | 角色名称 |
| level | number | 角色等级 |
| experience | number | 经验值 |
| attributes | CharacterAttributes | 角色属性 |
| inventory | InventoryItem[] | 物品栏 |

#### 3.2.5 成就数据 (achievements)

| 字段名 | 类型 | 说明 |
|-------|------|------|
| id | string | 成就唯一标识 |
| title | string | 成就标题 |
| description | string | 成就描述 |
| icon | string | 成就图标 |
| unlocked | boolean | 解锁状态 |
| unlockedAt | string | 解锁时间 |
| rewardXp | number | 奖励经验值 |
| rewardGold | number | 奖励金币 |

## 4. 备份管理功能

### 4.1 手动备份

用户可以随时创建手动备份：

1. 进入设置页面
2. 选择"数据管理"选项卡
3. 点击"创建本地备份"按钮
4. 系统将自动生成备份文件并下载到本地

### 4.2 自动备份

系统支持自动备份功能：

| 设置项 | 说明 | 默认值 |
|-------|------|--------|
| 启用自动备份 | 开关自动备份功能 | false |
| 备份周期 | 设置自动备份的时间间隔 | 24小时 |
| 备份时间 | 设置每天自动备份的具体时间 | 23:00 |

### 4.3 备份历史管理

系统会记录所有备份历史，包括：

- 备份ID
- 备份名称
- 备份日期和时间
- 备份大小
- 备份状态 (成功/失败/进行中)
- 备份类型 (手动/自动)

## 5. 数据恢复功能

### 5.1 从备份历史恢复

1. 进入设置页面
2. 选择"数据管理"选项卡
3. 在备份历史列表中找到要恢复的备份
4. 点击"恢复"按钮
5. 确认恢复操作后，系统将从备份中恢复数据

### 5.2 从本地文件恢复

1. 进入设置页面
2. 选择"数据管理"选项卡
3. 点击"导入本地备份"按钮
4. 选择本地备份文件
5. 系统验证文件格式后恢复数据

## 6. 技术实现

### 6.1 备份创建流程

```mermaid
flowchart TD
    A[用户触发备份] --> B[创建备份记录]
    B --> C[更新备份状态为"进行中"]
    C --> D[获取游戏数据]
    D --> E[生成JSON备份文件]
    E --> F[下载备份文件]
    F --> G[更新备份状态为"成功"]
    E --> H[备份失败]
    H --> I[更新备份状态为"失败"]
```

### 6.2 数据存储机制

- **备份元数据**：存储在localStorage的`localBackups`键中
- **备份文件**：以JSON格式下载到用户本地设备
- **备份命名规则**：`人生游戏备份_YYYY-MM-DD-HH-mm-ss.json`

### 6.3 备份文件格式

备份文件采用JSON格式，包含完整的游戏数据结构，便于查看和编辑。文件大小根据数据量不同而变化，通常在几KB到几十KB之间。

## 7. 使用指南

### 7.1 创建本地备份

1. 点击页面右上角的设置图标
2. 选择"数据管理"选项
3. 在"本地备份操作"区域点击"创建本地备份"
4. 等待备份完成，系统会自动下载备份文件

### 7.2 设置自动备份

1. 进入"数据管理"设置页面
2. 找到"自动备份设置"区域
3. 开启"启用自动备份"开关
4. 设置合适的备份周期和时间
5. 点击"保存备份设置"按钮

### 7.3 恢复数据

1. 进入"数据管理"设置页面
2. 在"备份历史"列表中找到要恢复的备份
3. 点击对应备份的"恢复"按钮
4. 在确认对话框中点击"确定"
5. 等待恢复完成，系统会自动刷新数据

### 7.4 导入外部备份

1. 进入"数据管理"设置页面
2. 点击"导入本地备份"按钮
3. 选择要导入的备份文件
4. 等待系统验证和恢复

## 8. 最佳实践

1. **定期手动备份**：建议每周至少手动创建一次备份
2. **启用自动备份**：设置合适的自动备份周期，确保数据安全
3. **多设备备份**：将备份文件存储在云端或外部存储设备
4. **验证备份完整性**：定期检查备份文件是否能正常导入
5. **合理管理备份历史**：删除不需要的旧备份，保持备份列表整洁

## 9. 故障排除

### 9.1 备份失败

- **原因**：存储空间不足、浏览器限制、数据损坏
- **解决方案**：
  - 检查浏览器存储空间设置
  - 清除不必要的本地数据
  - 尝试手动备份
  - 检查控制台错误信息

### 9.2 恢复失败

- **原因**：备份文件损坏、版本不兼容、数据格式错误
- **解决方案**：
  - 尝试使用其他备份文件
  - 检查备份文件格式是否正确
  - 确认备份文件与当前游戏版本兼容

### 9.3 备份文件过大

- **原因**：长期未清理数据、大量项目或习惯数据
- **解决方案**：
  - 清理不必要的项目和习惯
  - 删除旧的备份文件
  - 考虑定期归档数据

## 10. 安全注意事项

1. **备份文件安全性**：备份文件包含敏感的个人数据，请妥善保管
2. **避免公开分享**：不要将备份文件上传到公共平台或分享给他人
3. **定期更新备份密码**：如果使用加密存储，定期更换密码
4. **注意备份文件权限**：确保备份文件的访问权限设置正确

## 11. 版本兼容性

| 游戏版本 | 备份格式版本 | 兼容性 |
|---------|------------|--------|
| v1.0.0+ | v1 | 完全兼容 |

## 12. 未来改进计划

1. **增量备份**：仅备份变化的数据，减少备份文件大小
2. **云备份集成**：支持将备份同步到云存储服务
3. **备份加密**：提供备份文件加密功能，增强数据安全性
4. **选择性恢复**：允许用户选择特定数据项进行恢复
5. **备份压缩**：采用压缩算法减小备份文件大小
6. **自动清理**：根据设置自动删除旧备份文件

## 13. 技术支持

如果在使用本地备份功能时遇到问题，请：

1. 检查浏览器控制台是否有错误信息
2. 尝试清除浏览器缓存和localStorage数据
3. 查看最新的更新日志，确认是否有相关修复
4. 联系技术支持团队获取帮助

---

**文档版本**：v1.0.0  
**更新日期**：2026-01-12  
**适用游戏版本**：v1.0.0+  
**作者**：人生游戏管理系统开发团队