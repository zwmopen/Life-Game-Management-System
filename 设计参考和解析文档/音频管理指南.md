# 番茄钟系统音频管理指南

## 1. 音频文件位置与结构

### 1.1 音频文件存放位置

番茄钟系统的音频文件存放在 `public/audio/` 目录下，具体结构如下：

```
public/
└── audio/
    ├── bgm/                 # 通用背景音乐
    ├── pomodoro/            # 番茄钟音效
    │   └── bgm/             # 番茄钟背景音乐 (您存放100多个本地背景音乐的地方)
    ├── battle/              # 战斗音效
    ├── dice/                # 骰子音效
    ├── sfx/                 # 通用音效
    └── sounds/              # 额外音效
```

### 1.2 番茄钟背景音乐目录

您本地的100多个背景音乐文件应该存放在以下目录：

```
public/audio/pomodoro/bgm/
```

这是专门为番茄钟功能设计的背景音乐目录，系统会自动扫描此目录下的所有音频文件并在番茄钟界面中显示。

## 2. 支持的音频格式

系统支持以下音频格式：
- `.mp3` (推荐)
- `.wav`
- `.ogg`
- `.m4a`

## 3. 文件命名规则

### 3.1 推荐命名方式

为了确保音频文件名能正确显示在界面中，建议遵循以下命名规则：

- 使用有意义的中文或英文文件名
- 文件名即为在番茄钟界面中显示的音乐名称
- 避免使用特殊字符（如 `!@#$%^&*()` 等）
- 可以使用连字符 `-` 和下划线 `_` 分隔单词

**示例：**
- ✅ `森林晨光.mp3`
- ✅ `海浪声.mp3`
- ✅ `阿尔法波音乐.mp3`
- ✅ `专注背景音乐.mp3`
- ❌ `music#1.mp3`
- ❌ `专注音乐!.mp3`

### 3.2 文件名显示逻辑

系统会自动将文件名（不含扩展名）显示在番茄钟的背景音乐选择菜单中。例如：
- 文件 `森林晨光.mp3` → 菜单显示 "森林晨光"
- 文件 `专注背景音乐.mp3` → 菜单显示 "专注背景音乐"

## 4. 如何添加新音频文件

### 4.1 添加步骤

1. 将您的音频文件复制到 `public/audio/pomodoro/bgm/` 目录
2. 确保文件名清晰描述音频内容（这将成为界面中显示的名称）
3. 重启开发服务器或刷新页面
4. 在番茄钟界面点击音乐按钮，您添加的音频文件就会出现在列表中

### 4.2 批量添加

您可以一次性添加多个音频文件，系统会自动扫描目录中的所有支持格式的音频文件。

## 5. 音频管理系统功能

### 5.1 自动扫描

系统会在启动时自动扫描 `public/audio/pomodoro/bgm/` 目录，获取所有音频文件并将其加入播放列表。

### 5.2 播放统计

系统会记录每首音乐的播放次数，并根据播放次数对音乐进行排序，播放次数多的音乐会优先显示。

### 5.3 静音功能

在音乐选择菜单中有一个"静音"选项，可以选择关闭背景音乐。

## 6. 常见问题及解决方案

### 6.1 添加的音频文件未显示在列表中

**可能原因及解决方案：**
1. 文件格式不受支持 - 确保使用 `.mp3`、`.wav`、`.ogg` 或 `.m4a` 格式
2. 文件名包含特殊字符 - 检查并重命名文件，去除特殊字符
3. 未刷新页面 - 尝试刷新浏览器页面
4. 路径错误 - 确认文件已放置在 `public/audio/pomodoro/bgm/` 目录下

### 6.2 中文文件名显示乱码

如果遇到中文文件名显示问题，请尝试：
1. 确保文件名编码为 UTF-8
2. 重新启动开发服务器
3. 检查文件名是否包含不支持的字符

### 6.3 音频文件无法播放

1. 检查音频文件是否损坏
2. 确认音频格式是否被浏览器支持
3. 检查文件权限是否正确

## 7. 性能建议

### 7.1 文件大小

- 建议单个音频文件大小不超过 5MB
- 过大的文件会影响加载速度

### 7.2 音频质量

- 对于背景音乐，建议使用 128kbps - 192kbps 的 MP3 格式
- 平衡音质和文件大小

## 8. 故障排除

### 8.1 检查音频文件是否被正确识别

1. 确认文件位于正确的目录：`public/audio/pomodoro/bgm/`
2. 确认文件格式受支持
3. 确认文件名不包含特殊字符
4. 检查浏览器开发者工具的网络标签页，确认音频文件可以正常访问

### 8.2 重新加载音频列表

如果您添加了新文件但未在界面中显示：
1. 刷新浏览器页面
2. 如果仍然不显示，尝试清除浏览器缓存
3. 检查开发服务器控制台是否有错误信息

## 9. 目录说明

### 9.1 `/pomodoro/bgm/` - 番茄钟背景音乐
- **用途**：番茄钟功能专用背景音乐
- **使用场景**：番茄钟专注/休息时段的背景音乐
- **文件命名**：建议使用描述性中文名称，如 `森林晨光.mp3`, `海浪声.mp3`
- **说明**：这就是您存放100多个本地背景音乐的目录，每个文件名都会直接显示在番茄钟的音乐选择菜单中

### 9.2 其他目录
- `/bgm/` - 系统通用背景音乐
- `/pomodoro/` - 番茄钟提示音效（开始、结束、警告等）
- `/battle/` - 战斗相关音效
- `/dice/` - 骰子功能音效
- `/sfx/` - 系统通用音效

---

**注意**：所有音频文件必须放置在正确的目录中才能被系统正确识别和使用。对于番茄钟背景音乐，务必放在 `public/audio/pomodoro/bgm/` 目录下，文件名将直接显示在番茄钟的音乐选择界面中。