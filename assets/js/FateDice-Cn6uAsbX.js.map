{"version":3,"file":"FateDice-Cn6uAsbX.js","sources":["../../../components/FateDice.tsx"],"sourcesContent":["import React, { useRef, useEffect, useState, memo } from 'react';\nimport * as THREE from 'three';\nimport { RoundedBoxGeometry } from 'three-stdlib';\nimport { Theme, DiceState } from '../types';\n// 导入统一音效管理库（优化版）\nimport soundManager from '../utils/soundManagerOptimized';\n\ninterface FateDiceProps {\n  theme: Theme;\n  diceState: DiceState | undefined;\n  onSpinDice?: () => { success: boolean; message?: string };\n  onUpdateDiceState?: (updates: Partial<DiceState>) => void;\n  onAddFloatingReward?: (text: string, color: string) => void;\n}\n\nconst FateDice: React.FC<FateDiceProps> = memo(({ theme, diceState, onSpinDice, onUpdateDiceState, onAddFloatingReward }) => {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const canvasContainerRef = useRef<HTMLDivElement>(null);\n  const [isRolling, setIsRolling] = useState(false);\n  const [result, setResult] = useState<number | null>(null);\n  \n  // 音效相关\n  const audioContextRef = useRef<AudioContext | null>(null);\n\n  \n  // 剩余次数编辑功能 - todayCount 表示已使用次数\n  const [localTodayCount, setLocalTodayCount] = useState<number>(diceState?.todayCount || 0);\n  const [localDailyLimit, setLocalDailyLimit] = useState<number>(diceState?.config.dailyLimit || 10);\n  const [isEditingCount, setIsEditingCount] = useState<boolean>(false);\n  const [isEditingLimit, setIsEditingLimit] = useState<boolean>(false);\n  // 计算剩余次数\n  const remainingCount = localDailyLimit - localTodayCount;\n  \n  // Three.js相关引用\n  const sceneRef = useRef<THREE.Scene | null>(null);\n  const cameraRef = useRef<THREE.PerspectiveCamera | null>(null);\n  const rendererRef = useRef<THREE.WebGLRenderer | null>(null);\n  const diceMeshRef = useRef<THREE.Mesh | null>(null);\n  \n  // 主题相关样式\n  const isDark = theme.includes('dark');\n  const isNeomorphic = theme.startsWith('neomorphic');\n  const isNeomorphicDark = theme === 'neomorphic-dark';\n  \n  const bgColor = isNeomorphic \n    ? (isNeomorphicDark ? '#1e1e2e' : '#e0e5ec')\n    : isDark\n    ? '#1e1e2e'\n    : '#e0e5ec';\n  \n  const textColor = isNeomorphic\n    ? (isNeomorphicDark ? '#d8d8d8' : '#4d5b6d')\n    : isDark\n    ? '#d8d8d8'\n    : '#4d5b6d';\n  \n  const shadowLight = isNeomorphicDark ? '#1a1a2e' : '#ffffff';\n  const shadowDark = isNeomorphicDark ? '#0f0f1e' : '#a3b1c6';\n  \n  // 创建骰子纹理\n  const createDiceTextures = (renderer: THREE.WebGLRenderer) => {\n    const size = 512;\n    const textures: THREE.CanvasTexture[] = [];\n    const faceNumbers = [2, 5, 3, 4, 1, 6]; \n\n    faceNumbers.forEach(num => {\n      const canvas = document.createElement('canvas');\n      canvas.width = size;\n      canvas.height = size;\n      const ctx = canvas.getContext('2d');\n\n      if (ctx) {\n        // 1. 背景：纯净奶白，不再带灰\n        ctx.fillStyle = '#ffffff'; \n        ctx.fillRect(0, 0, size, size);\n\n        // 2. 极其微弱的暖色光晕 (模拟玉石温润感)\n        const grad = ctx.createRadialGradient(size/2, size/2, 0, size/2, size/2, size);\n        grad.addColorStop(0, 'rgba(255, 255, 255, 1)');\n        grad.addColorStop(1, 'rgba(240, 245, 250, 1)'); // 边缘微蓝冷调，呼应背景\n        ctx.fillStyle = grad;\n        ctx.fillRect(0, 0, size, size);\n\n        // 3. 绘制点数\n        drawPips(ctx, num, size);\n      }\n\n      const texture = new THREE.CanvasTexture(canvas);\n      texture.anisotropy = renderer.capabilities.getMaxAnisotropy();\n      textures.push(texture);\n    });\n\n    return textures;\n  };\n  \n  // 绘制骰子点数\n  const drawPips = (ctx: CanvasRenderingContext2D, num: number, size: number) => {\n    const r = size / 10;\n    const center = size / 2;\n    const offset = size / 3.6;\n\n    const draw = (x: number, y: number, color: string) => {\n      ctx.beginPath();\n      ctx.arc(x, y, r, 0, Math.PI * 2);\n      \n      ctx.fillStyle = color;\n      ctx.fill();\n\n      // 内凹阴影：稍微加深一点，增加清晰度\n      ctx.shadowBlur = 8;\n      ctx.shadowOffsetX = 3;\n      ctx.shadowOffsetY = 3;\n      ctx.shadowColor = 'rgba(163,177,198, 0.8)'; // 加深阴影\n      ctx.stroke();\n\n      ctx.shadowColor = 'transparent'; \n      \n      // 高光\n      ctx.beginPath();\n      ctx.arc(x, y, r, 0, Math.PI * 2);\n      ctx.strokeStyle = 'rgba(255,255,255, 0.9)';\n      ctx.lineWidth = 3;\n      ctx.stroke();\n    };\n\n    // 经典配色：1点正红，其他深黑\n    const pipColor = (num === 1) ? '#ef4444' : '#1e293b';\n\n    if (num === 1) {\n      ctx.beginPath();\n      ctx.arc(center, center, r * 1.6, 0, Math.PI * 2); // 1点大一点\n      ctx.fillStyle = pipColor;\n      ctx.fill();\n      // 1点特殊光泽\n      ctx.strokeStyle = 'rgba(0,0,0,0.05)';\n      ctx.lineWidth = 2;\n      ctx.stroke();\n      return;\n    }\n\n    if (num > 1) { \n      draw(center - offset, center - offset, pipColor);\n      draw(center + offset, center + offset, pipColor);\n    }\n    if (num > 3) { \n      draw(center + offset, center - offset, pipColor);\n      draw(center - offset, center + offset, pipColor);\n    }\n    if (num === 6) { \n      draw(center - offset, center, pipColor);\n      draw(center + offset, center, pipColor);\n    }\n    if (num % 2 === 1) { \n      draw(center, center, pipColor);\n    }\n  };\n  \n  // 创建骰子网格\n  const createDice = (renderer: THREE.WebGLRenderer) => {\n    // 增大骰子尺寸，从2.5x2.5x2.5调整为3.5x3.5x3.5\n    const geometry = new RoundedBoxGeometry(3.5, 3.5, 3.5, 10, 0.3);\n    \n    const textures = createDiceTextures(renderer);\n    \n    // --- 材质升级：白玉质感 ---\n    const materials = textures.map(texture => {\n      return new THREE.MeshStandardMaterial({\n        map: texture,\n        color: 0xffffff,       // 纯白基底\n        roughness: 0.15,       // 降低粗糙度 -> 表面光滑，反光更清晰\n        metalness: 0.05,       // 微量金属感 -> 增加质感硬度\n        envMapIntensity: 1.0,\n      });\n    });\n\n    const diceMesh = new THREE.Mesh(geometry, materials);\n    diceMesh.castShadow = true;\n    diceMesh.receiveShadow = true;\n    diceMesh.rotation.x = Math.random() * Math.PI;\n    diceMesh.rotation.y = Math.random() * Math.PI;\n    \n    return diceMesh;\n  };\n  \n  // 初始化Three.js场景\n  const initThreeJS = () => {\n    if (!canvasContainerRef.current) {\n      console.error('Canvas container not found');\n      return;\n    }\n    \n    // 仅在开发环境输出详细日志\n    if (process.env.NODE_ENV === 'development') {\n      // 初始化Three.js场景...\n    }\n    \n    // 确保容器有正确的尺寸\n    const containerWidth = canvasContainerRef.current.clientWidth;\n    const containerHeight = canvasContainerRef.current.clientHeight;\n    // 仅在开发环境输出详细日志\n    if (process.env.NODE_ENV === 'development') {\n      // 获取Canvas容器尺寸...\n    }\n    \n    // 创建场景\n    const scene = new THREE.Scene();\n    scene.background = new THREE.Color(bgColor);\n    scene.fog = new THREE.Fog(bgColor, 8, 25);\n    sceneRef.current = scene;\n    \n    // 创建相机，调整位置以适应更大的骰子\n    const camera = new THREE.PerspectiveCamera(\n      45, \n      containerWidth / containerHeight, \n      0.1, \n      100\n    );\n    // 将相机位置从9调整到10，确保更大的骰子能完整显示\n    camera.position.set(0, 0, 10);\n    cameraRef.current = camera;\n    \n    // 创建渲染器\n    const renderer = new THREE.WebGLRenderer({ antialias: true });\n    renderer.setSize(containerWidth, containerHeight);\n    renderer.setPixelRatio(window.devicePixelRatio);\n    renderer.shadowMap.enabled = true;\n    renderer.shadowMap.type = THREE.PCFSoftShadowMap;\n    renderer.toneMapping = THREE.ACESFilmicToneMapping;\n    renderer.toneMappingExposure = 1.1;\n    \n    // 清空容器并添加渲染器\n    canvasContainerRef.current.innerHTML = '';\n    canvasContainerRef.current.appendChild(renderer.domElement);\n    rendererRef.current = renderer;\n    \n    // --- 灯光系统升级 (更明亮，更通透) ---\n    // 环境光\n    const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);\n    scene.add(ambientLight);\n\n    // 主光源：强烈的白光，制造清晰的亮面\n    const mainLight = new THREE.DirectionalLight(0xffffff, 1.5);\n    mainLight.position.set(-5, 10, 5);\n    mainLight.castShadow = true;\n    mainLight.shadow.mapSize.width = 1024;\n    mainLight.shadow.mapSize.height = 1024;\n    mainLight.shadow.radius = 2;\n    mainLight.shadow.bias = -0.0001;\n    scene.add(mainLight);\n\n    // 辅助光源，确保骰子各个面都能被照亮\n    const fillLight = new THREE.DirectionalLight(0xffffff, 0.8);\n    fillLight.position.set(5, 5, 5);\n    scene.add(fillLight);\n\n    // 地面阴影\n    const planeGeometry = new THREE.PlaneGeometry(100, 100);\n    const planeMaterial = new THREE.ShadowMaterial({ \n      opacity: 0.1, \n      color: 0x4d5b6d \n    });\n    const plane = new THREE.Mesh(planeGeometry, planeMaterial);\n    plane.rotation.x = -Math.PI / 3;\n    plane.position.y = -10; \n    plane.receiveShadow = true;\n    scene.add(plane);\n    \n    // 创建骰子\n    const diceMesh = createDice(renderer);\n    scene.add(diceMesh);\n    diceMeshRef.current = diceMesh;\n    // 仅在开发环境输出详细日志\n    if (process.env.NODE_ENV === 'development') {\n      // 骰子网格创建并添加到场景...\n    }\n    \n    // 立即渲染一帧，确保骰子能够显示\n    renderer.render(scene, camera);\n    \n    // 开始动画循环\n    animate();\n    // 仅在开发环境输出详细日志\n    if (process.env.NODE_ENV === 'development') {\n      // Three.js场景初始化成功...\n    }\n  };\n  \n  // 动画循环\n  const animationFrameRef = useRef<number>(0);\n  \n  const animate = () => {\n    animationFrameRef.current = requestAnimationFrame(animate);\n    \n    if (rendererRef.current && sceneRef.current && cameraRef.current && diceMeshRef.current) {\n      if (!isRolling) {\n        const time = Date.now() * 0.001;\n        diceMeshRef.current.position.y = Math.sin(time) * 0.12; \n        diceMeshRef.current.rotation.x += 0.001;\n        diceMeshRef.current.rotation.y += 0.002;\n      }\n      \n      // 在动画期间禁用Three.js渲染器的指针事件\n      if (isRolling) {\n        rendererRef.current.domElement.style.pointerEvents = 'none';\n      } else {\n        rendererRef.current.domElement.style.pointerEvents = 'auto';\n      }\n      \n      rendererRef.current.render(sceneRef.current, cameraRef.current);\n    }\n  };\n  \n  // 生成更真实的骰子滚动音效 - 清脆的碰撞声\n  const generateRollingSound = () => {\n    if (!audioContextRef.current) return;\n    \n    const audioContext = audioContextRef.current;\n    const startTime = audioContext.currentTime;\n    \n    // 模拟骰子在碗中碰撞的连续声音\n    const soundCount = 8; // 碰撞次数\n    const baseFreq = 600; // 基础频率，更高频率更清脆\n    \n    for (let i = 0; i < soundCount; i++) {\n      // 每个碰撞声使用不同的频率和持续时间\n      const freq = baseFreq + Math.random() * 400; // 600-1000Hz，更清脆\n      const duration = 0.05 + Math.random() * 0.05; // 0.05-0.1秒，更短更干脆\n      \n      // 创建振荡器\n      const oscillator = audioContext.createOscillator();\n      const gainNode = audioContext.createGain();\n      \n      oscillator.connect(gainNode);\n      gainNode.connect(audioContext.destination);\n      \n      // 使用冲击波形，更像碰撞声\n      oscillator.type = 'square';\n      \n      // 快速的音量冲击，模拟碰撞的瞬间\n      gainNode.gain.setValueAtTime(0.5, startTime + i * 0.1);\n      gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + i * 0.1 + duration);\n      \n      // 频率快速下降，模拟碰撞后的衰减\n      oscillator.frequency.setValueAtTime(freq, startTime + i * 0.1);\n      oscillator.frequency.exponentialRampToValueAtTime(freq * 0.5, startTime + i * 0.1 + duration);\n      \n      oscillator.start(startTime + i * 0.1);\n      oscillator.stop(startTime + i * 0.1 + duration);\n    }\n  };\n  \n  // 生成结果音效\n  const generateResultSound = () => {\n    if (!audioContextRef.current) return;\n    \n    const audioContext = audioContextRef.current;\n    const startTime = audioContext.currentTime;\n    \n    // 创建两个振荡器，一个主音和一个泛音\n    const mainOscillator = audioContext.createOscillator();\n    const mainGain = audioContext.createGain();\n    \n    const harmonicOscillator = audioContext.createOscillator();\n    const harmonicGain = audioContext.createGain();\n    \n    mainOscillator.connect(mainGain);\n    harmonicOscillator.connect(harmonicGain);\n    mainGain.connect(audioContext.destination);\n    harmonicGain.connect(audioContext.destination);\n    \n    // 主音：400Hz，正弦波\n    mainOscillator.frequency.setValueAtTime(400, startTime);\n    mainOscillator.type = 'sine';\n    \n    // 泛音：800Hz，正弦波\n    harmonicOscillator.frequency.setValueAtTime(800, startTime);\n    harmonicOscillator.type = 'sine';\n    \n    // 主音音量包络\n    mainGain.gain.setValueAtTime(0.0, startTime);\n    mainGain.gain.linearRampToValueAtTime(0.4, startTime + 0.05);\n    mainGain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.5);\n    \n    // 泛音音量包络\n    harmonicGain.gain.setValueAtTime(0.0, startTime);\n    harmonicGain.gain.linearRampToValueAtTime(0.2, startTime + 0.08);\n    harmonicGain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.4);\n    \n    mainOscillator.start(startTime);\n    mainOscillator.stop(startTime + 0.5);\n    \n    harmonicOscillator.start(startTime);\n    harmonicOscillator.stop(startTime + 0.4);\n  };\n  \n  // 音频元素引用\n  const diceSoundRef = useRef<HTMLAudioElement | null>(null);\n  \n  // 掷骰子\n  const rollDice = () => {\n    if (isRolling || !diceMeshRef.current || !onSpinDice || (diceState?.isSpinning || (remainingCount <= 0))) return;\n    \n    // 播放滚动音效 - 优先使用本地音频文件\n    try {\n      // 直接创建音频元素播放音效\n      const audio = new Audio('/audio/sfx/投骰子音效.mp3');\n      audio.volume = 0.7;\n      audio.play().catch(error => {\n        console.warn('FateDice: Audio playback failed, falling back to generated sound:', error);\n        // 回退到生成的音效\n        generateRollingSound();\n      });\n    } catch (error) {\n      console.warn('FateDice: Failed to create audio element, using generated sound:', error);\n      generateRollingSound();\n    }\n    \n    setIsRolling(true);\n    \n    // 设置超时保护，如果动画长时间未完成则强制重置\n    setTimeout(() => {\n      if (isRolling) {\n        console.warn('FateDice: Roll animation timed out, resetting isRolling state');\n        setIsRolling(false);\n      }\n    }, 3000); // 3秒后强制重置\n    \n    // 生成随机结果用于3D动画显示\n    const rollResult = Math.floor(Math.random() * 6) + 1;\n    \n    // 旋转目标\n    const rotations: Record<number, { x: number; y: number }> = {\n      1: { x: 0, y: 0 },\n      6: { x: Math.PI, y: 0 },\n      2: { x: 0, y: -Math.PI/2 },\n      5: { x: 0, y: Math.PI/2 },\n      3: { x: -Math.PI/2, y: 0 },\n      4: { x: Math.PI/2, y: 0 }\n    };\n    \n    const target = rotations[rollResult];\n    const roundsX = (Math.floor(Math.random() * 3) + 4) * (Math.PI * 2);\n    const roundsY = (Math.floor(Math.random() * 3) + 4) * (Math.PI * 2);\n    \n    const currentX = diceMeshRef.current.rotation.x;\n    const currentY = diceMeshRef.current.rotation.y;\n    \n    const targetRotation = {\n      x: currentX + roundsX + (target.x - (currentX % (Math.PI * 2))),\n      y: currentY + roundsY + (target.y - (currentY % (Math.PI * 2)))\n    };\n    \n    // 确保旋转增量正确\n    let deltaX = target.x - (currentX % (Math.PI * 2));\n    if (deltaX < 0) deltaX += Math.PI * 2;\n    targetRotation.x = currentX + deltaX + roundsX;\n    \n    let deltaY = target.y - (currentY % (Math.PI * 2));\n    if (deltaY < 0) deltaY += Math.PI * 2;\n    targetRotation.y = currentY + deltaY + roundsY;\n    \n    const duration = 2500;\n    const startTime = performance.now();\n    const startRotation = { x: currentX, y: currentY };\n    \n    // 动画函数\n    const animateRoll = (time: number) => {\n      const elapsed = time - startTime;\n      const progress = Math.min(elapsed / duration, 1);\n      const ease = 1 - Math.pow(1 - progress, 4);\n      \n      if (diceMeshRef.current) {\n        diceMeshRef.current.rotation.x = startRotation.x + (targetRotation.x - startRotation.x) * ease;\n        diceMeshRef.current.rotation.y = startRotation.y + (targetRotation.y - startRotation.y) * ease;\n        \n        if(progress < 1) {\n          diceMeshRef.current.position.y = Math.sin(progress * Math.PI * 5) * (1 - progress) * 1.8;\n        } else {\n          diceMeshRef.current.position.y = 0;\n        }\n      }\n      \n      if (progress < 1) {\n          requestAnimationFrame(animateRoll);\n        } else {\n          // 增加本地已使用次数\n          setLocalTodayCount(prev => Math.min(prev + 1, localDailyLimit));\n          \n          // 调用父组件传入的旋转函数，在动画完成后调用，确保用户体验\n          const result = onSpinDice();\n          if (!result.success && result.message && onAddFloatingReward) {\n            onAddFloatingReward(result.message, 'text-red-500');\n          }\n          \n          // 确保重置滚动状态\n          setIsRolling(false);\n          \n          // 确保在动画完成后允许交互\n          setTimeout(() => {\n            if (rendererRef.current && rendererRef.current.domElement) {\n              rendererRef.current.domElement.style.pointerEvents = 'auto';\n            }\n          }, 100);\n        }\n    };\n    \n    requestAnimationFrame(animateRoll);\n  };\n  \n  // 初始化音频元素\n  const initAudioElement = () => {\n    try {\n      // 创建音频元素并设置音效文件\n      const audio = new Audio();\n      // 尝试使用相对路径\n      audio.src = '/audio/sfx/投骰子音效.mp3';\n      audio.volume = 0.7;\n      audio.preload = 'auto';\n      \n      // 监听音频加载错误\n      audio.addEventListener('error', (e) => {\n        console.error('音频加载错误:', e);\n        // 回退到生成的音效\n        // 仅在开发环境输出详细日志\n        if (process.env.NODE_ENV === 'development') {\n          // 回退到生成音效...\n        }\n      });\n      \n      diceSoundRef.current = audio;\n      // 仅在开发环境输出详细日志\n      if (process.env.NODE_ENV === 'development') {\n        // 音频元素初始化成功...\n      }\n    } catch (error) {\n      console.error('无法初始化音频元素:', error);\n    }\n  };\n  \n  // 生成回退音效 - 简单的骰子碰撞声\n  const generateFallbackSound = () => {\n    if (!audioContextRef.current) {\n      // 初始化音频上下文\n      try {\n        audioContextRef.current = new (window.AudioContext || (window as any).webkitAudioContext)();\n      } catch (error) {\n        console.error('无法初始化音频上下文:', error);\n        return;\n      }\n    }\n    \n    const audioContext = audioContextRef.current;\n    const startTime = audioContext.currentTime;\n    \n    // 生成多个频率的声音，模拟骰子碰撞\n    const frequencies = [600, 700, 800, 900, 1000];\n    \n    frequencies.forEach((freq, index) => {\n      const oscillator = audioContext.createOscillator();\n      const gainNode = audioContext.createGain();\n      \n      oscillator.connect(gainNode);\n      gainNode.connect(audioContext.destination);\n      \n      oscillator.type = 'square';\n      oscillator.frequency.setValueAtTime(freq, startTime + index * 0.05);\n      \n      gainNode.gain.setValueAtTime(0.5, startTime + index * 0.05);\n      gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + index * 0.05 + 0.1);\n      \n      oscillator.frequency.exponentialRampToValueAtTime(freq * 0.5, startTime + index * 0.05 + 0.1);\n      \n      oscillator.start(startTime + index * 0.05);\n      oscillator.stop(startTime + index * 0.05 + 0.1);\n    });\n  };\n  \n  // 播放骰子音效\n  const playDiceSound = () => {\n    // 使用统一的音效管理系统播放骰子音效\n    soundManager.playSoundEffect('dice');\n  };\n  \n  // 窗口大小调整\n  const handleResize = () => {\n    if (!cameraRef.current || !rendererRef.current || !canvasContainerRef.current) return;\n    \n    const width = canvasContainerRef.current.clientWidth;\n    const height = canvasContainerRef.current.clientHeight;\n    \n    // 仅在尺寸实际发生变化时更新，避免不必要的重绘\n    if (rendererRef.current.domElement.width !== width || rendererRef.current.domElement.height !== height) {\n      cameraRef.current.aspect = width / height;\n      cameraRef.current.updateProjectionMatrix();\n      \n      rendererRef.current.setSize(width, height);\n      rendererRef.current.setPixelRatio(window.devicePixelRatio);\n    }\n  };\n  \n  // 防止在动画过程中触发不必要的滚动\n  useEffect(() => {\n    const preventScroll = (e: Event) => {\n      if (isRolling) {\n        e.preventDefault();\n        e.stopPropagation();\n        return false;\n      }\n    };\n    \n    const diceContainer = containerRef.current;\n    if (diceContainer) {\n      // 防止鼠标滚轮滚动\n      diceContainer.addEventListener('wheel', preventScroll, { passive: false });\n      // 防止触摸滚动\n      diceContainer.addEventListener('touchmove', preventScroll, { passive: false });\n      // 防止键盘滚动\n      diceContainer.addEventListener('keydown', preventScroll, { passive: false });\n    }\n    \n    // 全局滚动监听，防止页面滚动 - 仅在动画期间临时添加\n    const preventGlobalScroll = (e: Event) => {\n      if (isRolling) {\n        e.preventDefault();\n        e.stopPropagation();\n        return false;\n      }\n    };\n    \n    // 只有在骰子容器存在且当前组件可见时才添加全局监听器\n    if (isRolling && diceContainer) {\n      document.body.addEventListener('wheel', preventGlobalScroll, { passive: false });\n      document.body.addEventListener('touchmove', preventGlobalScroll, { passive: false });\n    }\n    \n    return () => {\n      if (diceContainer) {\n        diceContainer.removeEventListener('wheel', preventScroll);\n        diceContainer.removeEventListener('touchmove', preventScroll);\n        diceContainer.removeEventListener('keydown', preventScroll);\n      }\n      // 确保清理全局事件监听器\n      document.body.removeEventListener('wheel', preventGlobalScroll);\n      document.body.removeEventListener('touchmove', preventGlobalScroll);\n    };\n  }, []); // 移除isRolling依赖，只在组件挂载和卸载时执行\n  \n  // 管理全局滚动禁用，根据isRolling状态动态添加/移除\n  useEffect(() => {\n    const preventGlobalScroll = (e: Event) => {\n      if (isRolling) {\n        e.preventDefault();\n        // 注意：不调用stopPropagation，以避免影响其他组件\n        return false;\n      }\n    };\n    \n    if (isRolling) {\n      // 当开始滚动时添加全局监听器\n      document.body.addEventListener('wheel', preventGlobalScroll, { passive: false });\n      document.body.addEventListener('touchmove', preventGlobalScroll, { passive: false });\n    }\n    \n    // 清理函数 - 无论isRolling状态如何都要清理\n    return () => {\n      document.body.removeEventListener('wheel', preventGlobalScroll);\n      document.body.removeEventListener('touchmove', preventGlobalScroll);\n    };\n  }, [isRolling]); // 依赖isRolling状态\n  \n  // 初始化和清理\n  useEffect(() => {\n    // 主题变化触发useEffect...\n    \n    // 初始化Three.js场景\n    initThreeJS();\n    \n    // 添加窗口大小调整事件监听\n    window.addEventListener('resize', handleResize);\n    \n    // 使用ResizeObserver监听容器尺寸变化\n    let resizeObserver: ResizeObserver | null = null;\n    if (canvasContainerRef.current) {\n      resizeObserver = new ResizeObserver(() => {\n        // 延迟执行，确保DOM更新完成\n        setTimeout(handleResize, 0);\n      });\n      resizeObserver.observe(canvasContainerRef.current);\n    }\n    \n    // 手动触发一次调整大小，确保初始渲染正确\n    setTimeout(() => {\n      handleResize();\n    }, 100);\n    \n    // 添加安全超时，确保isRolling状态不会卡住\n    const rollingTimeout = setInterval(() => {\n      if (isRolling) {\n        console.warn('FateDice: Animation timeout detected, resetting isRolling state');\n        setIsRolling(false);\n      }\n    }, 5000); // 5秒检查一次\n    \n    return () => {\n      clearInterval(rollingTimeout);\n      window.removeEventListener('resize', handleResize);\n      \n      // 清理ResizeObserver\n      if (resizeObserver) {\n        resizeObserver.disconnect();\n        resizeObserver = null;\n      }\n      \n      // 清理动画帧\n      if (animationFrameRef.current) {\n        cancelAnimationFrame(animationFrameRef.current);\n      }\n      \n      // 清理Three.js资源\n      if (rendererRef.current) {\n        rendererRef.current.dispose();\n        rendererRef.current = null;\n      }\n      \n      if (sceneRef.current) {\n        // 清理场景中的所有对象\n        sceneRef.current.traverse((object) => {\n          if (object instanceof THREE.Mesh) {\n            if (object.geometry) {\n              object.geometry.dispose();\n            }\n            if (object.material) {\n              if (Array.isArray(object.material)) {\n                object.material.forEach(material => {\n                  if (material.map) material.map.dispose();\n                  if (material.lightMap) material.lightMap.dispose();\n                  if (material.bumpMap) material.bumpMap.dispose();\n                  if (material.normalMap) material.normalMap.dispose();\n                  if (material.specularMap) material.specularMap.dispose();\n                  if (material.alphaMap) material.alphaMap.dispose();\n                  if (material.aoMap) material.aoMap.dispose();\n                  if (material.displacementMap) material.displacementMap.dispose();\n                  if (material.emissiveMap) material.emissiveMap.dispose();\n                  if (material.environmentMap) material.environmentMap.dispose();\n                  material.dispose();\n                });\n              } else {\n                const material = object.material;\n                if (material.map) material.map.dispose();\n                if (material.lightMap) material.lightMap.dispose();\n                if (material.bumpMap) material.bumpMap.dispose();\n                if (material.normalMap) material.normalMap.dispose();\n                if (material.specularMap) material.specularMap.dispose();\n                if (material.alphaMap) material.alphaMap.dispose();\n                if (material.aoMap) material.aoMap.dispose();\n                if (material.displacementMap) material.displacementMap.dispose();\n                if (material.emissiveMap) material.emissiveMap.dispose();\n                if (material.environmentMap) material.environmentMap.dispose();\n                material.dispose();\n              }\n            }\n          }\n        });\n        sceneRef.current = null;\n      }\n      \n      if (cameraRef.current) {\n        cameraRef.current = null;\n      }\n      \n      if (diceMeshRef.current) {\n        diceMeshRef.current = null;\n      }\n      \n      // 清理音频上下文\n      if (audioContextRef.current) {\n        if (audioContextRef.current.state !== 'closed') {\n          audioContextRef.current.close();\n        }\n        audioContextRef.current = null;\n      }\n    };\n  }, [theme, bgColor, shadowDark, shadowLight, textColor]);\n  \n  // 当diceState变化时，更新本地剩余次数和总数\n  useEffect(() => {\n    if (diceState?.todayCount !== undefined) {\n      setLocalTodayCount(diceState.todayCount);\n    }\n    if (diceState?.config.dailyLimit !== undefined) {\n      setLocalDailyLimit(diceState.config.dailyLimit);\n    }\n  }, [diceState?.todayCount, diceState?.config.dailyLimit]);\n  \n  return (\n    <div \n      ref={containerRef}\n      className=\"w-full mx-auto rounded-xl p-1 xs:p-2 sm:p-3 md:p-4 transition-all duration-300 max-w-none\"\n      style={{\n        backgroundColor: bgColor,\n        boxShadow: `9px 9px 16px ${shadowDark}, -9px -9px 16px ${shadowLight}`,\n        transform: 'translateY(0)',\n        transition: 'all 0.3s ease'\n      }}\n    >\n      {/* 3D骰子容器 */}\n      <div \n        ref={canvasContainerRef}\n        className=\"w-full h-[120px] xs:h-[150px] sm:h-[200px] md:h-[250px] lg:h-[300px] mb-4 rounded-xl overflow-hidden relative\"\n        style={{ backgroundColor: bgColor }}\n      ></div>\n      \n      {/* 剩余次数显示 - 移到按钮上方 */}\n      <div className=\"mb-4 text-center px-2\">\n        <div className=\"flex flex-wrap items-center justify-center gap-1 xs:gap-2 text-xs sm:text-sm md:text-base\">\n          <div className=\"font-medium truncate max-w-[100px]\" style={{ color: textColor }}>\n            今日剩余次数\n          </div>\n          {isEditingCount ? (\n            <input\n              type=\"number\"\n              min=\"0\"\n              max={localDailyLimit}\n              value={remainingCount}\n              onChange={(e) => {\n                const remaining = Math.max(0, parseInt(e.target.value) || 0);\n                // remainingCount = localDailyLimit - localTodayCount → localTodayCount = localDailyLimit - remaining\n                setLocalTodayCount(localDailyLimit - remaining);\n              }}\n              className={`text-base font-bold ${isDark ? 'text-blue-400' : 'text-blue-600'} bg-transparent border-b border-blue-400 focus:outline-none w-12 text-center`}\n              style={{ color: isDark ? '#3b82f6' : '#2563eb' }}\n              autoFocus\n              onBlur={() => {\n                setIsEditingCount(false);\n                if (onUpdateDiceState) {\n                  onUpdateDiceState({ todayCount: localTodayCount });\n                }\n              }}\n              onKeyPress={(e) => {\n                if (e.key === 'Enter') {\n                  setIsEditingCount(false);\n                  if (onUpdateDiceState) {\n                    onUpdateDiceState({ todayCount: localTodayCount });\n                  }\n                }\n              }}\n            />\n          ) : (\n            <div \n              className={`text-base font-bold cursor-pointer ${isDark ? 'text-blue-400' : 'text-blue-600'}`}\n              onDoubleClick={() => setIsEditingCount(true)}\n            >\n              {remainingCount}\n            </div>\n          )}\n          \n          <div className=\"text-base font-bold\" style={{ color: textColor }}>/</div>\n          \n          <div \n            className={`text-base font-bold cursor-pointer`}\n            style={{ color: textColor }}\n            onDoubleClick={() => setIsEditingLimit(true)}\n          >\n            {localDailyLimit}\n          </div>\n        </div>\n      </div>\n      \n      {/* 掷骰子按钮 */}\n      <div className=\"text-center px-1 xs:px-2\">\n        <button\n          onClick={isRolling || diceState?.isSpinning || remainingCount <= 0 ? undefined : rollDice}\n          disabled={isRolling || (diceState?.isSpinning || (remainingCount <= 0))}\n          className={`w-full py-1.5 xs:py-2 px-3 xs:px-4 text-sm xs:text-base sm:text-lg font-bold rounded-md transition-all duration-300 ${\n            isNeomorphic ? (isNeomorphicDark ? 'bg-[#1e1e2e] text-blue-400 hover:text-blue-300' : 'bg-[#e0e5ec] text-blue-600 hover:text-blue-700') : (isDark ? 'bg-zinc-800 hover:bg-zinc-700 text-white' : 'bg-slate-100 hover:bg-slate-200 text-slate-800')\n          } ${\n            isNeomorphic ? `shadow-${isNeomorphicDark ? 'inner' : 'md'} hover:shadow-${isNeomorphicDark ? 'lg' : 'lg'} active:shadow-inner` : 'shadow-sm'\n          } ${\n            isRolling || (diceState?.isSpinning || (remainingCount <= 0)) ? 'opacity-60 cursor-not-allowed' : ''\n          }`}\n          style={{\n            boxShadow: isNeomorphic ? `9px 9px 16px ${shadowDark}, -9px -9px 16px ${shadowLight}` : '',\n            pointerEvents: isRolling || diceState?.isSpinning || remainingCount <= 0 ? 'none' : 'auto'\n          }}\n        >\n          {isRolling || diceState?.isSpinning ? '投掷中...' : '开始投掷'}\n        </button>\n      </div>\n    </div>\n  );\n});\n\nFateDice.displayName = 'FateDice';\n\nexport default FateDice;"],"names":["jsxRuntimeExports","reactExports","Mesh","Scene","Color","Fog","PerspectiveCamera","WebGLRenderer","PCFSoftShadowMap","ACESFilmicToneMapping","AmbientLight","DirectionalLight","PlaneGeometry","ShadowMaterial","RoundedBoxGeometry","MeshStandardMaterial","CanvasTexture","FateDice","memo","theme","diceState","onSpinDice","onUpdateDiceState","onAddFloatingReward","containerRef","useRef","canvasContainerRef","isRolling","setIsRolling","useState","audioContextRef","localTodayCount","setLocalTodayCount","todayCount","localDailyLimit","setLocalDailyLimit","config","dailyLimit","isEditingCount","setIsEditingCount","isEditingLimit","setIsEditingLimit","remainingCount","sceneRef","cameraRef","rendererRef","diceMeshRef","isDark","includes","isNeomorphic","startsWith","isNeomorphicDark","bgColor","textColor","shadowLight","shadowDark","createDice","renderer","geometry","textures","size","forEach","num","canvas","document","createElement","width","height","ctx","getContext","fillStyle","fillRect","grad","createRadialGradient","addColorStop","r","center","offset","draw","x","y","color","beginPath","arc","Math","PI","fill","shadowBlur","shadowOffsetX","shadowOffsetY","shadowColor","stroke","strokeStyle","lineWidth","pipColor","drawPips","texture","THREE.CanvasTexture","anisotropy","capabilities","getMaxAnisotropy","push","createDiceTextures","materials","map","THREE.MeshStandardMaterial","roughness","metalness","envMapIntensity","diceMesh","THREE.Mesh","castShadow","receiveShadow","rotation","random","animationFrameRef","animate","current","requestAnimationFrame","time","Date","now","position","sin","domElement","style","pointerEvents","render","generateRollingSound","audioContext","startTime","currentTime","i","freq","duration","oscillator","createOscillator","gainNode","createGain","connect","destination","type","gain","setValueAtTime","exponentialRampToValueAtTime","frequency","start","stop","handleResize","clientWidth","clientHeight","aspect","updateProjectionMatrix","setSize","setPixelRatio","window","devicePixelRatio","useEffect","preventScroll","e","preventDefault","stopPropagation","diceContainer","addEventListener","passive","preventGlobalScroll","body","removeEventListener","console","error","containerWidth","containerHeight","scene","THREE.Scene","background","THREE.Color","fog","THREE.Fog","camera","THREE.PerspectiveCamera","set","THREE.WebGLRenderer","antialias","shadowMap","enabled","THREE.PCFSoftShadowMap","toneMapping","THREE.ACESFilmicToneMapping","toneMappingExposure","innerHTML","appendChild","ambientLight","THREE.AmbientLight","add","mainLight","THREE.DirectionalLight","shadow","mapSize","radius","bias","fillLight","planeGeometry","THREE.PlaneGeometry","planeMaterial","THREE.ShadowMaterial","opacity","plane","initThreeJS","resizeObserver","ResizeObserver","setTimeout","observe","rollingTimeout","setInterval","warn","clearInterval","disconnect","cancelAnimationFrame","dispose","traverse","object","material","Array","isArray","lightMap","bumpMap","normalMap","specularMap","alphaMap","aoMap","displacementMap","emissiveMap","environmentMap","state","close","jsxs","ref","className","backgroundColor","boxShadow","transform","transition","children","jsx","min","max","value","onChange","remaining","parseInt","target","autoFocus","onBlur","onKeyPress","key","onDoubleClick","onClick","isSpinning","audio","Audio","volume","play","catch","rollResult","floor","roundsX","roundsY","currentX","currentY","targetRotation","deltaX","deltaY","performance","startRotation","animateRoll","elapsed","progress","ease","pow","prev","result","success","message","disabled","displayName"],"mappings":"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"}